<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tower of Hanoi Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            width: 80%;
            max-width: 800px;
            margin: auto;
            overflow: hidden;
            padding: 20px;
        }
        header {
            background: #35424a;
            color: #ffffff;
            padding-top: 30px;
            min-height: 70px;
            border-bottom: #0e7be0 3px solid;
        }
        header h1 {
            margin: 0;
            text-align: center;
            font-size: 40px;
        }
        .section {
            background: #ffffff;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 5px;
        }
        .auth-options, .nav-buttons {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            background: #0e7be0;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            margin: 5px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        form {
            display: flex;
            flex-direction: column;
        }
        input {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .tower {
            display: inline-block;
            width: 100px;
            height: 150px;
            background-color: #ddd;
            margin: 0 10px;
            position: relative;
        }
        .disk {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            height: 20px;
            background-color: #0e7be0;
            transition: all 0.3s ease;
        }
        #steps {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Tower of Hanoi Game</h1>
        </div>
    </header>

    <div class="container">
        <div id="home" class="section">
            <h2>Welcome to the Tower of Hanoi Puzzle</h2>
            <p>Challenge your mind with this classic mathematical game. Move the entire stack of disks from the leftmost peg to the rightmost peg, following these rules:</p>
            <ul>
                <li>Only one disk can be moved at a time.</li>
                <li>Each move consists of taking the upper disk from one of the stacks and placing it on top of another stack or on an empty rod.</li>
                <li>No larger disk may be placed on top of a smaller disk.</li>
            </ul>
            <div class="auth-options">
                <button onclick="showSection('signup')">Sign Up</button>
                <button onclick="showSection('login')">Login</button>
            </div>
        </div>

        <div id="signup" class="section hidden">
            <h2>Sign Up</h2>
            <form id="signup-form">
                <input type="text" id="signup-username" placeholder="Username" required>
                <input type="email" id="signup-email" placeholder="Email" required>
                <input type="password" id="signup-password" placeholder="Password" required>
                <input type="password" id="signup-confirm-password" placeholder="Confirm Password" required>
                <button type="submit">Sign Up</button>
            </form>
            <button onclick="showSection('home')">Back to Home</button>
        </div>

        <div id="login" class="section hidden">
            <h2>Login</h2>
            <form id="login-form">
                <input type="text" id="login-username" placeholder="Username" required>
                <input type="password" id="login-password" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
            <button onclick="showSection('home')">Back to Home</button>
        </div>

        <div id="game-setup" class="section hidden">
            <h2>Game Setup</h2>
            <input type="number" id="disk-count" min="3" max="8" value="3" placeholder="Number of disks">
            <input type="number" id="move-guess" placeholder="Guess number of moves">
            <button onclick="startGame()">Start Game</button>
            <button onclick="showSection('home')">Back to Home</button>
            <div id="user-scoreboard"></div>
        </div>

        <div id="game" class="section hidden">
            <h2>Tower of Hanoi Game</h2>
            <div id="towers">
                <div class="tower" id="tower1"></div>
                <div class="tower" id="tower2"></div>
                <div class="tower" id="tower3"></div>
            </div>
            <button id="solve">Solve</button>
            <div id="steps"></div>
            <div class="nav-buttons">
                <button onclick="resetGame()">Reset Game</button>
                <button onclick="showSection('game-setup')">New Game</button>
                <button onclick="showSection('home')">Back to Home</button>
            </div>
        </div>

        <div id="scoreboard" class="section hidden">
            <h2>Scoreboard</h2>
            <ul id="scores"></ul>
            <button onclick="showSection('game-setup')">Play Again</button>
            <button onclick="showSection('home')">Back to Home</button>
        </div>
    </div>

    <script>
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let currentUser = null;
        let moveCount = 0;
        let diskCount = 3;
        let userGuess = 0;

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');

            if (sectionId === 'home') {
                currentUser = null;
            }

            if (sectionId === 'game-setup' && currentUser) {
                showUserScoreboard();
            }
        }

        document.getElementById('signup-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('signup-username').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm-password').value;

            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }

            if (users.some(user => user.username === username)) {
                alert('Username already exists');
                return;
            }

            users.push({ username, email, password, scores: [] });
            localStorage.setItem('users', JSON.stringify(users));
            alert('Signup successful. Please login.');
            showSection('login');
        });

        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            currentUser = users.find(u => u.username === username && u.password === password);
            if (currentUser) {
                showSection('game-setup');
            } else {
                alert('Invalid credentials');
            }
        });

        function startGame() {
            diskCount = parseInt(document.getElementById('disk-count').value);
            userGuess = parseInt(document.getElementById('move-guess').value);
            showSection('game');
            initGame();
        }

        function initGame() {
            const towers = [
                document.getElementById('tower1'),
                document.getElementById('tower2'),
                document.getElementById('tower3')
            ];

            towers.forEach(tower => tower.innerHTML = '');
            moveCount = 0;
            document.getElementById('steps').innerHTML = '';

            for (let i = diskCount; i > 0; i--) {
                const disk = document.createElement('div');
                disk.className = 'disk';
                disk.style.width = `${i * 20}px`;
                disk.style.bottom = `${(diskCount - i) * 20}px`;
                towers[0].appendChild(disk);
            }

            let selectedDisk = null;

            towers.forEach((tower, index) => {
                tower.onclick = () => {
                    if (!selectedDisk) {
                        if (tower.lastChild) {
                            selectedDisk = tower.lastChild;
                            selectedDisk.style.backgroundColor = 'red';
                        }
                    } else {
                        if (!tower.lastChild || parseInt(selectedDisk.style.width) < parseInt(tower.lastChild.style.width)) {
                            tower.appendChild(selectedDisk);
                            selectedDisk.style.backgroundColor = '#0e7be0';
                            selectedDisk.style.bottom = `${(tower.childElementCount - 1) * 20}px`;
                            selectedDisk = null;
                            moveCount++;
                            updateSteps(`Move ${moveCount}: Disk moved to Tower ${index + 1}`);

                            if (towers[2].childElementCount === diskCount) {
                                endGame();
                            }
                        } else {
                            alert('Invalid move');
                            selectedDisk.style.backgroundColor = '#0e7be0';
                            selectedDisk = null;
                        }
                    }
                };
            });

            document.getElementById('solve').onclick = () => {
                solveTowerOfHanoi(diskCount, towers[0], towers[2], towers[1]);
            };
        }

        function solveTowerOfHanoi(n, source, destination, auxiliary) {
            if (n > 0) {
                solveTowerOfHanoi(n - 1, source, auxiliary, destination);
                moveDisk(source, destination);
                solveTowerOfHanoi(n - 1, auxiliary, destination, source);
            }
        }

        function moveDisk(source, destination) {
            setTimeout(() => {
                const disk = source.lastChild;
                destination.appendChild(disk);
                disk.style.bottom = `${(destination.childElementCount - 1) * 20}px`;
                moveCount++;
                updateSteps(`Move ${moveCount}: Disk moved from Tower ${source.id.slice(-1)} to Tower ${destination.id.slice(-1)}`);
                if (destination.childElementCount === diskCount && destination.id === 'tower3') {
                    endGame();
                }
            }, 1000);
        }

        function updateSteps(step) {
            const stepsDiv = document.getElementById('steps');
            stepsDiv.innerHTML += `<p>${step}</p>`;
            stepsDiv.scrollTop = stepsDiv.scrollHeight;
        }

        function endGame() {
            const minMoves = Math.pow(2, diskCount) - 1;
            let score = 0;
            let message = `Game Over! You took ${moveCount} moves. `;

            if (userGuess === minMoves) {
                score = 10;
                message += "Perfect guess! You scored 10 points.";
            } else {
                message += `The minimum number of moves was ${minMoves}. You scored 0 points.`;
            }

            currentUser.scores.push({ diskCount, moves: moveCount, score });
            users = users.map(u => u.username === currentUser.username ? currentUser : u);
            localStorage.setItem('users', JSON.stringify(users));

            alert(message);
            showSection('scoreboard');
            showScoreboard();
        }

        function showScoreboard() {
            const scoresList = document.getElementById('scores');
            scoresList.innerHTML = '';

            currentUser.scores.forEach((game, index) => {
                const li = document.createElement('li');
                li.textContent = `Game ${index + 1}: ${game.diskCount} disks, ${game.moves} moves, Score: ${game.score}`;
                scoresList.appendChild(li);
            });
        }

        function showUserScoreboard() {
            const userScoreboard = document.getElementById('user-scoreboard');
            userScoreboard.innerHTML = '<h3>Your Previous Scores</h3>';
            const scoresList = document.createElement('ul');
            
            currentUser.scores.slice(-5).forEach((game, index) => {
                const li = document.createElement('li');
                li.textContent = `Game ${currentUser.scores.length - 4 + index}: ${game.diskCount} disks, ${game.moves} moves, Score: ${game.score}`;
                scoresList.appendChild(li);
            });
            
            userScoreboard.appendChild(scoresList);
        }

        function resetGame() {
            initGame();
        }
    </script>
</body>
</html>